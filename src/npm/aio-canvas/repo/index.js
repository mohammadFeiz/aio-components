function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}import React,{Component,createRef}from"react";import $ from"jquery";import{jsx as _jsx}from"react/jsx-runtime";export default class Canvas{constructor(){_defineProperty(this,"mp",{}),_defineProperty(this,"listenToMousePosition",t=>{this.mousePosition=t}),_defineProperty(this,"canvasToClient",()=>[100,100]),_defineProperty(this,"clientToCanvas",()=>[0,0]),_defineProperty(this,"getActions",({clientToCanvas:t,canvasToClient:e})=>{this.clientToCanvas=t,this.canvasToClient=e}),_defineProperty(this,"render",t=>_jsx(CANVAS,{...t,listenToMousePosition:this.listenToMousePosition.bind(this),getActions:t=>this.getActions(t),getSize:t=>this.size=t})),this.size=[0,0]}};class CANVAS extends Component{constructor(t){super(t),this.PI=Math.PI/180,this.dom=createRef(),this.width=0,this.height=0,this.touch="ontouchstart"in document.documentElement,this.state={screenPosition:t.screenPosition},!0===t.onPan?(this.getScreenPosition=()=>this.state.screenPosition,this.setScreenPosition=t=>this.setState({screenPosition:t})):(this.getScreenPosition=()=>this.props.screenPosition,this.setScreenPosition=e=>t.onPan(e)),$(window).on("resize",this.resize.bind(this)),this.mousePosition=[1/0,1/0],t.getActions({canvasToClient:this.canvasToClient.bind(this),clientToCanvas:this.clientToCanvas.bind(this)})}getPrepDip(t){var e=this.getDip(t);return e.m=-1/e.m,e}getDip([t,e]){var i=t[1]-e[1],s=t[0]-e[0],o=i/s;return{deltaY:i,deltaX:s,m:o}}getAvg(t){for(var e=0,i=0,s=t.length,o=0;o<s;o++)e+=t[o][0],i+=t[o][1];return[e/s,i/s]}getAngle(t){var e,i,s,{line:o}=t;t.line?(e=o[1][0]-o[0][0],i=o[1][1]-o[0][1]):t.dip&&(e=-t.dip.deltaX,i=-t.dip.deltaY);var s=this.getLength([[0,0],[e,i]]),n=Math.acos(e/s)/Math.PI*180;return parseFloat((n=0>Math.sign(i)?360-n:n).toFixed(4))}getLength([t,e]){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}getPrepFromLine(t){var{point:e,offset:i,line:s,dip:o=this.getDip(s)}=t;if(!i)return e;var n=this.getAngle({dip:o}),[r,h]=this.getLineBySLA(e,i,n-90);return h}getLineBySLA(t,e,i){return e?[t,[t[0]+Math.cos(i*Math.PI/180)*e,t[1]+Math.sin(i*Math.PI/180)*e]]:[t,t]}getArcByPoints(t){for(var{arcPoints:e,height:i}=t,s=[],o=[],n=0;n<e.length&&3!==n;n++){var r=e[n],h=r.toString();-1===o.indexOf(h)&&(o.push(h),s.push(r))}var a=s[0],l=s[1],$=s[2],u={};if(1===s.length)u={r:0,x:a[0],y:a[1]};else if(2===s.length){let p=this.getAvg([a,l]);u=i?this.getArcBy3Points(a,this.getPrepFromLine({point:p,line:[a,l],offset:i}),l):{r:this.getLength([a,l])/2,x:p[0],y:p[1]}}else u=this.getArcBy3Points(a,l,$);return t={...u,...t}}getArcBy3Points(t,e,i){var s,o=this.getPrepDip([t,e]),n=this.getPrepDip([e,i]),r=this.getAvg([t,e]),h=this.getAvg([e,i]),a=this.getMeet({point1:r,dip1:o,point2:h,dip2:n});if(!a)return!1;var l=a[0],$=a[1],u=this.getAngle({line:[a,t]}),p=this.getAngle({line:[a,e]}),g=this.getAngle({line:[a,i]});return s=u<p&&p<g?[u,g]:p<g&&g<u?[u,g]:g<u&&u<p?[u,g]:g<p&&p<u?[g,u]:u<g&&g<p?[g,u]:p<u&&u<g?[g,u]:[0,0],{x:l,y:$,r:this.getLength([t,[l,$]]),slice:s}}getMeet(t){var{line1:e,line2:i,point1:s=e[0],point2:o=i[0],dip1:n=this.getDip(e),dip2:r=this.getDip(i)}=t;if(n.m===r.m)return!1;if(Math.abs(n.m)===1/0)return[s[0],this.getYOnLineByX({point:o,dip:r,x:s[0]})];if(Math.abs(r.m)===1/0)return[o[0],this.getYOnLineByX({point:s,dip:n,x:o[0]})];var h=(n.m*s[0]-r.m*o[0]+o[1]-s[1])/(n.m-r.m),a=n.m*(h-s[0])+s[1];return[h,a]}getYOnLineByX(t){var{x:e,line:i,point:s=i[0],dip:o=this.getDip(i)}=t;return o.m!==1/0&&o.m*(e-s[0])+s[1]}getPopintsByNGon(t,e,i){let s=180-360/e,o=2*+(Math.cos(s/2*Math.PI/180)*t).toFixed(6),n=+(Math.sin(s/2*Math.PI/180)*t).toFixed(6),r=[0,-n,i],h=[0+o/2,-n,i],a=[r,h],l=360/e;for(let $=0;$<e-1;$++){let u=[a[$+1][0]+Math.cos(l*Math.PI/180)*o,a[$+1][1]+Math.sin(l*Math.PI/180)*o,i];l+=360/e,a.push(u)}return a.push(r),a}getXOnLineByY(t){var{y:e,line:i,point:s=i[0],dip:o=this.getDip(i)}=t;return 0!==o.m&&(o.m===1/0?s[0]:(e-s[1])/o.m+s[0])}eventHandler(t,e,i,s="bind"){var o={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"};e=this.touch?o[e]:e;var n="string"==typeof t?"window"===t?$(window):$(t):t;n.unbind(e,i),"bind"===s&&n.bind(e,i)}getClient(t,e=this.touch){return e?{x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}:{x:t.clientX,y:t.clientY}}getValueByRange(t,e,i){var s="function"==typeof t?t():t,o=typeof s;return void 0===o?e:"number"===o?s:this.getValueByPercent(parseFloat(s),e,i)}getValueByPercent(t,e,i){return e+t*(i-e)/100}validateItem(t){"boolean"!=typeof t.showPivot&&console.error("r-canvas => item.showPivot must be boolean!!!"),-1===["bevel","round","miter"].indexOf(t.lineJoin)&&console.error("r-canvas => item.lineJoin must be bevel,round or miter!!!"),-1===["butt","round","square"].indexOf(t.lineCap)&&console.error("r-canvas => item.lineCap must be butt,round or square!!!"),-1===["number","string"].indexOf(typeof t.rotate)&&console.error('r-canvas =>item.rotate must be number or string contain number and "%"(example:120 or "50%")!!!'),"string"==typeof t.rotate&&-1===t.rotate.indexOf("%")&&console.error('r-canvas =>missing "%" in item.rotate string!!!'),-1===["number","string"].indexOf(typeof t.x)&&console.error('r-canvas =>item.x must be number or string contain number and "%"(example:120 or "50%")!!!'),"string"==typeof t.x&&-1===t.x.indexOf("%")&&console.error('r-canvas =>missing "%" in item.x string!!!'),isNaN(t.x)&&console.error("r-canvas => item.x must be number!!!"),-1===["number","string"].indexOf(typeof t.y)&&console.error('r-canvas =>item.y must be number or string contain number and "%"(example:120 or "50%")!!!'),"string"==typeof t.y&&-1===t.y.indexOf("%")&&console.error('r-canvas =>missing "%" in item.y string!!!'),isNaN(t.y)&&console.error("r-canvas => item.y must be number!!!"),(isNaN(t.lineWidth)||t.lineWidth<0)&&console.error("r-canvas => item.lineWidth must be number >= 0!!!"),(isNaN(t.opacity)||t.opacity<0||t.opacity>1)&&console.error("r-canvas => item.opacity must be a number between 0 and 1!!!"),t.arcPoints&&(!Array.isArray(t.arcPoints)||t.arcPoints.length<2)&&console.error("r-canvas => item.arcPoints must be an array with 2 or 3 member!!!"),t.pivot&&(!Array.isArray(t.pivot)||2!==t.pivot.length)&&console.error("r-canvas => item.pivot must be an array with 2 numeric member!!!"),t.dash&&(!Array.isArray(t.dash)||2!==t.dash.length)&&console.error("r-canvas => item.dash must be an array with 2 numeric member!!!"),t.slice&&(!Array.isArray(t.slice)||2!==t.slice.length)&&console.error("r-canvas => item.slice must be an array with 2 numeric member!!!")}resize(){this.timer=0,clearInterval(this.interval),this.interval=setInterval(()=>{this.timer++,this.timer>=20&&(this.update(),clearInterval(this.interval))},10)}getRandomColor(t,e=60){function i(){return[e+Math.round(Math.random()*(255-e)),e+Math.round(Math.random()*(255-e)),e+Math.round(Math.random()*(255-e))]}var t=i();return t[Math.round(3*Math.random())]=0,{color:`rgb(${t[0]},${t[1]},${t[2]})`,r:t[0],g:t[1],b:t[2]}}getCoordsByPivot(t){var{pivot:e,x:i,y:s}=t;if(!e)return[i,s];var[o=0,n=0]="function"==typeof e?e(t):e;return[i-this.getValueByRange(o,0,this.width),s- -this.getValueByRange(n,0,this.height)]}getItem(item,parent={},index,length){var result,{x:parentx=0,y:parenty=0,rotate:parentrotate=0,opacity:parentOpacity=1,fill:parentFill,stroke:parentStroke,sequence=[]}=parent;let sequenceProps={};try{for(let i=0;i<sequence.length;i++){let[prop,statement]=sequence[i].split(":");eval(`sequenceProps.${prop} = ${statement}`)}}catch{}var{debugMode}=this.props,originalItem="function"==typeof item?{...item(this.props)}:item,type=originalItem.type;type||console.error("RCanvas => missing type in item:");var updatedItem=JSON.parse(JSON.stringify(originalItem));let{fill=sequenceProps.fill||parentFill,stroke=sequenceProps.stroke||parentStroke,rotate=sequenceProps.rotate||0,x=sequenceProps.x||0,y=sequenceProps.y||0,slice=sequenceProps.slice,opacity=sequenceProps.opacity||1,lineWidth=sequenceProps.lineWidth||this.props.lineWidth||1,r=sequenceProps.r}=updatedItem;if((updatedItem={showPivot:!1,lineJoin:"miter",lineCap:"butt",...updatedItem,fill,stroke,rotate,slice,opacity,lineWidth,r,x,y}).items=originalItem.items,updatedItem.rect=!1,updatedItem.stroke||updatedItem.fill||(updatedItem.stroke="#000"),debugMode&&this.validateItem(updatedItem),updatedItem.rotate=this.getValueByRange(updatedItem.rotate,0,360),updatedItem.x=this.getValueByRange(updatedItem.x,0,this.width)+parentx,updatedItem.y=-this.getValueByRange(updatedItem.y,0,this.height)+parenty,updatedItem.opacity*=parentOpacity,updatedItem.pivotedCoords=this.getCoordsByPivot(updatedItem),"Arc"===type&&originalItem.arcPoints){if(originalItem.arcPoints){var arc=this.getArcByPoints(originalItem);updatedItem.r=arc.r,updatedItem.slice=arc.slice,updatedItem.x=arc.x,updatedItem.y=-arc.y,updatedItem.pivotedCoords=this.getCoordsByPivot(updatedItem)}}else if("Rectangle"===type){updatedItem.type="Line";let{width=20,height=20,corner=[]}=updatedItem;width=this.getValueByRange(width,0,this.width),height=this.getValueByRange(height,0,this.height);let[c0=0,c1=0,c2=0,c3=0]=corner;updatedItem.rect=!0;let[x,y]=updatedItem.pivotedCoords;updatedItem.points=[[x+width/2,-y],[x+width,-y,c1],[x+width,-y+height,c2],[x,-y+height,c3],[x,-y,c0],[x+width/2,-y,c1]]}else if("NGon"===type){updatedItem.type="Line";let{r=20,count=6,corner=0,x,y}=updatedItem;updatedItem.points=this.getPopintsByNGon(r,count,corner)}else if("Triangle"===type){updatedItem.type="Line";let{corner=[],width=50,height=100,x,y}=updatedItem;Array.isArray(corner)||(corner=[corner]);let c1,c2,c3;0===corner.length?(c1=0,c2=0,c3=0):1===corner.length?(c1=corner[0],c2=corner[0],c3=corner[0]):2===corner.length?(c1=corner[0],c2=corner[1],c3=corner[0]):(c1=corner[0],c2=corner[1],c3=corner[2]),updatedItem.points=[[0,0,0],[width/2,0,c1],[0,height,c2],[-width/2,0,c3],[0,0,0]],console.log(updatedItem.points)}return{...originalItem,...updatedItem}}draw(t=this.props.items,e={},i=[]){for(var s="function"==typeof t?t():t,{zoom:o}=this.props,n=this.ctx,r=0;r<s.length;r++){let h=this.getItem(s[r],e,r,s.length);if(!1!==h.show){n.save(),n.beginPath(),this.rotate(h.rotate,[h.x,h.y]),n.globalAlpha=h.opacity,n.lineCap=h.lineCap,n.lineJoin=h.lineJoin,this.shadow(h,n),h.dash&&n.setLineDash(h.dash),n.lineWidth=h.lineWidth*o,n.strokeStyle="random"===h.stroke?this.getRandomColor().color:this.getColor(h.stroke,h.pivotedCoords),n.fillStyle="random"===h.fill?this.getRandomColor().color:this.getColor(h.fill,h.pivotedCoords);var a=i.concat(r);if(h.type)this["draw"+h.type](h,a);else{var l="items["+a.join("].items[")+"]";console.error("r-canvas => receive invalid item in "+l+" :"+JSON.stringify(h))}if(h.showPivot&&this.showPivot(h.x,h.y),this.eventMode&&h[this.eventMode]){let $=this.mousePosition.x*o+this.axisPosition[0]+this.screenX,u=-this.mousePosition.y*o+this.axisPosition[1]+this.screenY;h.fill&&n.isPointInPath($,u)?this.item=h:h.stroke&&n.isPointInStroke($,u)&&(this.item=h)}n.closePath(),n.restore()}}}drawGroup(t,e){var[i,s]=t.pivotedCoords;let o=[];if(t.repeatChilds)for(let n=0;n<t.items.length;n++){let r=t.items[n],{repeat:h=0}=t,{showPivot:a}=r;for(let l=0;l<h;l++)o.push({...r,isRepeat:l>0,showPivot:0===l&&a})}else o=t.items;this.draw(o,{x:i,y:s,rotate:t.rotate,opacity:t.opacity,fill:t.fill,stroke:t.stroke,sequence:t.sequence},e)}drawText({align:t=[0,0],fontSize:e=12,fontFamily:i="arial",text:s="Text",fill:o,stroke:n,pivotedCoords:r}){var{zoom:h}=this.props,[a,l]=r,[$,u]=this.getTextAlign(t);this.ctx.textAlign=$,this.ctx.textBaseline=u,this.ctx.font=`${e*h}px ${i}`,n&&this.ctx.strokeText(s,a*h,l*h),o&&this.ctx.fillText(s,a*h,l*h)}drawImage({pivotedCoords:t,width:e,height:i,image:s}){var o,{zoom:n}=this.props,[r,h]=t,a=new FileReader;a.onload=()=>{(o=new Image).onload=()=>this.ctx.drawImage(o,r*n,h*n,e*n,i*n),o.src=a.result},a.readAsDataURL(s)}drawLine({points:t,close:e,stroke:i,fill:s,pivotedCoords:o,rect:n}){if(t.length<1)return!1;var[r,h]=n?[0,0]:o,{zoom:a}=this.props,l=[this.getValueByRange(t[0][0],0,this.width)+r,-this.getValueByRange(t[0][1],0,this.height)+h];this.ctx.moveTo(l[0]*a,l[1]*a);for(var $=t[0],u=1;u<t.length;u++){let[p,g,c]=t[u];$=[p,g];let d=[this.getValueByRange(p,0,this.width)+r,-this.getValueByRange(g,0,this.height)+h];if(c){let[m,v]=t[u+1]?t[u+1]:t[0],y=[this.getValueByRange(m,0,this.width)+r,-this.getValueByRange(v,0,this.height)+h];this.ctx.arcTo(d[0]*a,d[1]*a,y[0]*a,y[1]*a,c*a)}else this.ctx.lineTo(d[0]*a,d[1]*a)}t.length>2&&e&&this.ctx.lineTo(l[0]*a,l[1]*a),i&&this.ctx.stroke(),s&&this.ctx.fill()}drawArc({pivotedCoords:t,r:e,slice:i=[0,360],fill:s,stroke:o}){var[n,r]=t,{rotateDirection:h}=this.props;if(e=(e=this.getValueByRange(e,this.width,this.height))<0?0:e,i=[this.getValueByRange(i[0],0,360),this.getValueByRange(i[1],0,360)],"clockwise"===h){let a=i[0];i=[-i[1],-a]}var{zoom:l}=this.props;this.ctx.arc(n*l,r*l,e*l,i[0]*this.PI,i[1]*this.PI),o&&this.ctx.stroke(),s&&this.ctx.fill()}showPivot(t,e){var i=this.ctx;i.beginPath(),i.arc(t,e,10,0,360*Math.PI/180),i.moveTo(t-15,e),i.lineTo(t+15,e),i.moveTo(t,e-15),i.lineTo(t,e+15),i.lineWidth=2,i.strokeStyle="rgba(255,100,0,.3)",i.stroke(),i.closePath()}rotate(t=0,[e,i]){if(0!==t){var{rotateDirection:s,zoom:o}=this.props,n=Math.sin(t=t*this.PI*("clock"===s?1:-1)),r=Math.cos(t);this.ctx.rotate(t);var h=e*r- -i*n-e,a=-i-(e*n+-i*r);this.ctx.translate(h*o,a*o)}}update(){var{getSize:t,grid:e,zoom:i}=this.props,s=$(this.dom.current);this.width=s.width(),this.height=s.height(),void 0!==s[0]&&null!==s[0]&&(s[0].width=this.width,s[0].height=this.height,this.axisPosition=[this.width/2,this.height/2],t&&t({x:this.width,y:this.height}),e&&s.css(this.getBackground(e,i,this.width,this.height)),this.clear(),this.setScreen(),e&&this.drawAxes(),this.draw())}clear(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.restore()}drawAxes(){var t=[3,3],e="#000";this.draw([{type:"Line",points:[[0,-4002],[0,4e3]],stroke:e,dash:t},{type:"Line",points:[[-4002,0],[4e3,0]],stroke:e,dash:t}])}componentDidMount(){let{onMount:t=()=>{}}=this.props;this.ctx=this.ctx||this.dom.current.getContext("2d"),this.update(),t()}componentDidUpdate(){this.update()}getColor(t,{x:e=0,y:i=0}){if(t){if("string"==typeof t)return t;var s=t.length;if(5===s)var o=this.ctx.createLinearGradient(t[0]+e,t[1]+i,t[2]+e,t[3]+i);else if(7===s)var o=this.ctx.createRadialGradient(t[0]+e,t[1]+i,t[2],t[3]+e,t[4]+i,t[5]);for(var n=t[t.length-1],r=0;r<n.length;r++){var h=n[r].split(" ");o.addColorStop(h[0],h[1])}return o}}shadow({shadow:t}){if(t){var e=this.ctx;e.shadowOffsetX=t[0],e.shadowOffsetY=t[1],e.shadowBlur=t[2],e.shadowColor=t[3]}}getSides(t){for(var e=t[0],i=e.x,s=e.y,o=e.x,n=e.y,r=1;r<t.length;r++){var{x:h,y:a}=t[r];h<i?i=h:h>o&&(o=h),a<s?s=a:a>n&&(n=a)}return{left:i,right:o,up:s,down:n,center:{x:(i+o)/2,y:(s+n)/2}}}getTextAlign([t=0,e=0]){return[["right","center","left"][t+1],["top","middle","bottom"][e+1]]}getBackground(){var t,{grid:e,zoom:i}=this.props,[s,o,n="rgba(70,70,70,0.3)"]=e,r=100*i,h=s?this.getValueByRange(s,0,this.width)*i+"px":"100%",a=o?this.getValueByRange(o,0,this.height)*i+"px":"100%",l=`linear-gradient(${n} 0px,transparent 0px)`,$=`linear-gradient(90deg,${n} 0px, transparent 0px)`;return{backgroundImage:`${l},${$},linear-gradient(${n} 1px, transparent 1px),linear-gradient(90deg,${n} 1px, transparent 1px)`,backgroundSize:`${r}px ${r}px,${r}px ${r}px,${h} ${a},${h} ${a}`}}panmousedown(t){this.eventHandler("window","mousemove",$.proxy(this.panmousemove,this)),this.eventHandler("window","mouseup",$.proxy(this.panmouseup,this)),this.panned=!1;let e=this.getScreenPosition();var i=this.getClient(t);this.startOffset={x:i.x,y:i.y,endX:e[0],endY:e[1]}}panmouseup(){this.eventHandler("window","mousemove",this.panmousemove,"unbind"),this.eventHandler("window","mouseup",this.panmouseup,"unbind")}panmousemove(t){var e=this.startOffset,{zoom:i}=this.props,s=this.getClient(t);this.panned=!0;var o=(e.x-s.x)/i+e.endX,n=(s.y-e.y)/i+e.endY;this.setScreenPosition([o,n])}onMouseDown(t){let{events:e,onPan:i}=this.props;this.mousePosition=this.getMousePosition(t),this.eventMode="onMouseDown",this.update(),this.item?this.item.onMouseDown(t,this.mousePosition,this.item,this.props):i&&this.setScreenPosition?this.panmousedown(t):e.onMouseDown&&e.onMouseDown(t,this.mousePosition),this.item=!1,this.eventMode=!1}onMouseUp(t){let{events:e}=this.props;this.mousePosition=this.getMousePosition(t),this.eventMode="onMouseUp",this.update(),this.item?this.item.onMouseUp(t,this.mousePosition,this.item,this.props):e.onMouseUp&&e.onMouseUp(t,this.mousePosition),this.item=!1,this.eventMode=!1}onClick(t){let{events:e}=this.props;this.mousePosition=this.getMousePosition(t,!1),this.eventMode="onClick",this.update(),this.item?this.item.onClick(t,this.mousePosition,this.item,this.props):e.onClick&&e.onClick(t,this.mousePosition),this.item=!1,this.eventMode=!1}onMouseMove(t){var{events:e,listenToMousePosition:i}=this.props;this.mousePosition=this.getMousePosition(t),e.onMouseMove&&e.onMouseMove(t,this.mousePosition),i(this.mousePosition)}setScreen(){var{zoom:t}=this.props;let e=this.getScreenPosition();var i=this.dom.current;this.screenX=-this.getValueByRange(e[0],0,this.width/t)*t,this.screenY=this.getValueByRange(e[1],0,this.height/t)*t,this.translate={x:this.screenX+this.axisPosition[0],y:this.screenY+this.axisPosition[1]},this.ctx.setTransform(1,0,0,1,0,0),this.ctx.translate(this.translate.x,this.translate.y),$(i).css({backgroundPosition:this.translate.x+"px "+this.translate.y+"px"})}canvasToClient(t,e){if(!t)return!1;var[i,s]=t;if(void 0===this.screenX)return!1;var{zoom:o}=this.props;return i=this.getValueByRange(i,0,this.width),s=this.getValueByRange(s,0,this.height),[Math.round(this.screenX+this.axisPosition[0]+i*o),Math.round(this.screenY+this.axisPosition[1]-s*o),i,s]}clientToCanvas([t,e],i=!0){var{zoom:s}=this.props,o=i?$(this.dom.current).offset():{left:0,top:0},n=[t-o.left+window.pageXOffset,e-o.top+window.pageYOffset];return[Math.floor((n[0]-this.axisPosition[0]-this.screenX)/s),-Math.floor((n[1]-this.axisPosition[1]-this.screenY)/s)]}getMousePosition(t,e){var i=this.getClient(t,e),[s,o]=this.clientToCanvas([i.x,i.y]);let[n,r]=this.canvasToClient([s,o]);return{x:s,y:o,px:100*s/this.width,py:100*o/this.height,cx:n,cy:r}}render(){var{id:t,style:e,className:i,events:s}=this.props,o={ref:this.dom,className:i,id:t,style:e};for(let n in s)o[n]=s[n];return this.touch?(o.onTouchStart=this.onMouseDown.bind(this),o.onTouchMove=this.onMouseMove.bind(this),o.onTouchEnd=this.onMouseUp.bind(this)):(o.onMouseDown=this.onMouseDown.bind(this),o.onMouseMove=this.onMouseMove.bind(this),o.onMouseUp=this.onMouseUp.bind(this)),o.onClick=this.onClick.bind(this),_jsx("canvas",{...o})}}CANVAS.defaultProps={zoom:1,selectable:!1,screenPosition:[0,0],items:[],events:{},rotateDirection:"clockwise"};