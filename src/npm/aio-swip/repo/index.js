function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}import{EventHandler as t,GetClient as e,Geo as i}from"../aio-utils";import s from"jquery";export default class o{constructor(o){_defineProperty(this,"p",void 0),_defineProperty(this,"geo",new i),_defineProperty(this,"defaultLimit",{width:0,height:0,left:0,top:0,right:0,bottom:0,centerX:0,centerY:0}),_defineProperty(this,"timeout",void 0),_defineProperty(this,"count",0),_defineProperty(this,"domLimit",this.defaultLimit),_defineProperty(this,"parentLimit",this.defaultLimit),_defineProperty(this,"getDom",()=>this.p.dom()),_defineProperty(this,"getParent",()=>this.p.parent?this.p.parent():void 0),_defineProperty(this,"dist",0),_defineProperty(this,"change",{x:0,y:0,dx:0,dy:0,dist:0,angle:0,deltaCenterAngle:0}),_defineProperty(this,"isMoving",!1),_defineProperty(this,"centerAngle",0),_defineProperty(this,"selectRect",void 0),_defineProperty(this,"defaultChange",{x:0,y:0,dx:0,dy:0,dist:0,angle:0,deltaCenterAngle:0}),_defineProperty(this,"dx",0),_defineProperty(this,"dy",0),_defineProperty(this,"cx",0),_defineProperty(this,"cy",0),_defineProperty(this,"so",{}),_defineProperty(this,"init",()=>{if(this.count++,this.count>10){clearTimeout(this.timeout);return}this.getDom().length?(clearTimeout(this.timeout),t(this.getDom(),"mousedown",s.proxy(this.mouseDown,this)),this.p.onClick&&t(this.getDom(),"click",s.proxy(this.click,this))):this.timeout=setTimeout(()=>this.init(),400)}),_defineProperty(this,"getPercentByValue",(t,e,i)=>100*(t-e)/(i-e)),_defineProperty(this,"getPage",()=>{let{page:t}=this.p;return t?t():s(window)}),_defineProperty(this,"getMousePosition",t=>{this.domLimit=this.getDOMLimit("dom");let{left:i,top:s,centerX:o,centerY:h,width:r,height:n}=this.domLimit,d=this.getPage(),p=e(t),m=p.x-i+d.scrollLeft(),c=p.y-s+d.scrollTop(),l=[[o,h],[p.x,p.y]],g=this.geo.getAngle(l),a=this.geo.getLength(l);if(this.p.maxCenterDistance&&a>this.p.maxCenterDistance){let u=[r/2,n/2],[f,y]=this.geo.getLineBySLA(u,this.p.maxCenterDistance,g)[1];m=f,c=y}return{clientX:p.x,clientY:p.y,x:m,y:c,centerAngle:g,centerDistance:a,xp:this.getPercentByValue(m,0,r),yp:this.getPercentByValue(c,0,n)}}),_defineProperty(this,"getDOMLimit",t=>{let e="dom"===t?this.getDom():this.getParent(),i=e.offset(),s={width:e.width(),height:e.height(),left:i.left,top:i.top,centerX:0,centerY:0};return{...s,centerX:s.left+s.width/2,centerY:s.top+s.height/2,right:s.left+s.width,bottom:s.top+s.height}}),_defineProperty(this,"click",t=>{if(this.isMoving)return;this.domLimit=this.getDOMLimit("dom"),this.parentLimit=this.p.parent?this.getDOMLimit("parent"):this.defaultLimit;let e=this.getMousePosition(t),i={mousePosition:e,domLimit:this.domLimit,parentLimit:this.parentLimit,event:t,change:this.defaultChange};this.p.onClick&&this.p.onClick(i)}),_defineProperty(this,"mouseDown",e=>{this.isMoving=!1,this.domLimit=this.getDOMLimit("dom"),this.parentLimit=this.p.parent?this.getDOMLimit("parent"):this.defaultLimit;let i=this.getMousePosition(e);this.centerAngle=i.centerAngle,this.cx=i.clientX,this.cy=i.clientY,this.so={client:{x:i.clientX,y:i.clientY}},this.addSelectRect(i.x,i.y);let o={mousePosition:i,domLimit:this.domLimit,parentLimit:this.parentLimit,event:e,change:this.defaultChange},h=(this.p.start||(()=>[0,0]))(o);if(!1===h||!Array.isArray(h))return;let r=h[0],n=h[1];this.so={...this.so,x:r,y:n},t("window","mousemove",s.proxy(this.mouseMove,this)),t("window","mouseup",s.proxy(this.mouseUp,this))}),_defineProperty(this,"mouseMove",t=>{t.stopPropagation();let{speedX:i=1,speedY:s=1,stepX:o=1,stepY:h=1,reverseX:r,reverseY:n,insideX:d,insideY:p}=this.p,m=this.getMousePosition(t),c=e(t),l=c.x-this.cx,g=c.y-this.cy;l=Math.round(l*i)*(r?-1:1),g=Math.round(g*s)*(n?-1:1);let a=m.centerAngle-this.centerAngle;if("number"==typeof o&&(l=Math.round(l/o)*o),"number"==typeof h&&(g=Math.round(g/h)*h),l===this.dx&&g===this.dy)return;this.isMoving=!0,this.dx=l,this.dy=g,this.dist=Math.round(Math.sqrt(Math.pow(l,2)+Math.pow(g,2)));let u=this.geo.getAngle([[this.cx,this.cy],[c.x,c.y]]);this.setSelectRect(l,g);let f=0,y=0;if(void 0!==this.so.x&&void 0!==this.so.y){f=this.so.x+l,y=this.so.y+g;let{minX:$,minY:L,maxX:P,maxY:v}=this.p;void 0!==$&&f<$&&(f=$),void 0!==P&&f>P&&(f=P),void 0!==L&&y<L&&(y=L),void 0!==v&&y>v&&(y=v)}!0===o&&(f=Math.round(f/this.domLimit.width)*this.domLimit.width),!0===h&&(y=Math.round(y/this.domLimit.height)*this.domLimit.height),d&&(this.parentLimit?(f>this.parentLimit.width-this.domLimit.width&&(f=this.parentLimit.width-this.domLimit.width),f<0&&(f=0)):alert("Swip error => you set insideX prop but missing parent props")),p&&(this.parentLimit?(y>this.parentLimit.height-this.domLimit.height&&(y=this.parentLimit.height-this.domLimit.height),y<0&&(y=0)):alert("Swip error => you set insideY prop but missing parent props")),this.change={x:f,y,dx:l,dy:g,dist:this.dist,angle:u,deltaCenterAngle:a};let w={change:this.change,mousePosition:m,domLimit:this.domLimit,parentLimit:this.parentLimit,event:t,selectRect:this.so.sr,isInSelectRect:this.getIsInSelectRect(this.so.sr||{left:0,top:0,width:0,height:0})};this.p.move&&this.p.move(w)}),_defineProperty(this,"mouseUp",e=>{e.stopPropagation(),t("window","mousemove",this.mouseMove,"unbind"),t("window","mouseup",this.mouseUp,"unbind"),setTimeout(()=>this.isMoving=!1,10);let i=this.getMousePosition(e);this.removeSelectRect();let s={change:this.change,event:e,domLimit:this.domLimit,parentLimit:this.parentLimit,mousePosition:i,selectRect:this.so.sr,isInSelectRect:this.getIsInSelectRect(this.so.sr||{left:0,top:0,width:0,height:0})};this.p.end&&this.p.end(s)}),_defineProperty(this,"getIsInSelectRect",t=>{let{left:e,top:i,width:s,height:o}=t;return(t,h)=>!(t<e)&&!(h<i)&&!(t>e+s)&&!(h>i+o)}),_defineProperty(this,"addSelectRect",(t,e)=>{if(!this.selectRect||!this.selectRect.enable())return;let{color:i}=this.selectRect,s=this.getDom();this.so.tsr={left:t,top:e},this.removeSelectRect(),s.append(`<div class="swip-select-rect" style="border:1px dashed ${i};background:${i+"30"};left:${t}px;top:${e}px;position:absolute;width:0;height:0"></div>`)}),_defineProperty(this,"setSelectRect",(t,e)=>{if(!this.selectRect||!this.selectRect.enable())return;let i=this.getDom().find(".swip-select-rect"),{tsr:s={left:0,top:0}}=this.so||{},o=s.left,h=s.top;t<0&&(o+=t,t=Math.abs(t)),e<0&&(h+=e,e=Math.abs(e));let r={left:o,top:h,width:t,height:e};this.so.sr=r,i.css(r)}),_defineProperty(this,"removeSelectRect",()=>{if(this.selectRect&&this.selectRect.enable())this.getDom().find(".swip-select-rect").remove()});let{selectRect:h}=o;if(h){let{color:r="#96a9bc"}=h;this.selectRect={...h,color:r}}this.p=o,this.init()}};export function getLeftAndTopByCenterAngleLength(t,e,s){let o=new i().getLineBySLA(t,s,e),[h,r]=o[1];return{left:h,top:r}}